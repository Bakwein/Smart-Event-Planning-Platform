<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head') %>
    <title>Profil Güncelleme</title>
    
    
</head>
<body>
    <%- include('../partials/user/nav') %>
    <div class="container mt-3">
        <div class="row">
            <div class="col-md-12 mt-3">
                <h3>Profil Güncelleme</h3>
            </div>
            <div class="col-md-12 mt-3">
                <img id="userPhoto" src="<%= photoPath %>" class="card-img-top mx-auto" alt="user icon" style="width: 50%; height: auto; cursor: pointer;">
                <input type="file" id="photoUpload" accept="image/*" style="display: none;">
            </div>
            <div class="col-md-12 mt-3">
                <form method="post">
                    <div class="row mb-3">
                        <label for="id" class="col-sm-2 col-from-label">Id</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="idkullanıcılar" name="idkullanıcılar" readonly value="<%= idkullanıcılar %>">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="KullanıcıAdı" class="col-sm-2 col-from-label">Kullanıcı Adı</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="KullanıcıAdı" name="KullanıcıAdı" value="<%= KullanıcıAdı %>">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="isim" class="col-sm-2 col-from-label">İsim:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="isim" name="isim" required  value="<%= isim %>">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="soyisim" class="col-sm-2 col-from-label">Soyisim:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="soyisim" name="soyisim"  value="<%= soyisim %>">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="dogumTarihi" class="col-sm-2 col-from-label">Doğum Tarihi:</label>
                        <div class="col-sm-8">
                            <input type="date" id="dogumTarihi" name="dogumTarihi" value="<%= dogumTarihi %>" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="cinsiyet" class="col-sm-2 col-from-label">Cinsiyet:</label>
                        <div class="col-sm-8">
                            <select id="cinsiyet" name="cinsiyet" required>
                                <option value="0" <%= cinsiyet == "0" ? "selected" : "" %>>Belirtmek İstemiyorum</option>
                                <option value="1" <%= cinsiyet == "1" ? "selected" : "" %>>Erkek</option>
                                <option value="2" <%= cinsiyet == "2" ? "selected" : "" %>>Kadın</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="telefon" class="col-sm-2 col-from-label">Telefon(+90):</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="telefon" name="telefon"  value="<%= telefon %>">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="konum" class="col-sm-2 col-from-label">Konum:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="konum" name="konum"  value="<%= konum %>">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="email" class="col-sm-2 col-from-label">Email:</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="email" name="email"  value="<%= email %>">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="sifre" class="col-sm-2 col-from-label">Şifre:</label>
                        <div class="col-sm-8">
                            <input type="password" class="form-control" id="sifre" name="sifre">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-sm-8 offset-sm-2">
                            <button type="submit" class="btn btn-primary">Güncelle</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <% if (message && message.length > 0) { %>
            <div class="row justify-content-center" style="margin-left: 90px;">
                <div class="col-md-8">
                    <div class="alert <%= alert_type %> row justify-content-center" role="alert">
                        <%= message %>
                    </div>
                </div>
            </div>
        <% } %>
    </div>

    <script>
        const userId = "<%= idkullanıcılar %>"; // Kullanıcının ID'sini burada dinamik olarak ayarla
        // Fotoğraf alanına tıklandığında dosya seçme penceresini aç
        document.getElementById("userPhoto").addEventListener("click", function() {
            document.getElementById("photoUpload").click();
        });
    
        // Dosya seçildikten sonra yapılacak işlemler
        document.getElementById("photoUpload").addEventListener("change", function(event) {
        const file = event.target.files[0];
        if (file) {
            const formData = new FormData();
            formData.append("photo", file);
            formData.append("id", userId);

            // Dosyayı AJAX ile gönder
            fetch("/upload_photo2", {
                method: "POST",
                body: formData
            })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url; // Yönlendirme yap
                } else {
                    return response.json();
                }
            })
            .then(data => {
                if (data && data.photoPath) {
                    document.getElementById("userPhoto").src = data.photoPath; // Yeni fotoğrafı güncelle
                }
            })
            .catch(error => {
                console.error("Fotoğraf yükleme hatası:", error);
            });
        }
    });
    </script>
    
</body>
</html>